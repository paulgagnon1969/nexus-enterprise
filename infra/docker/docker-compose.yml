services:
  postgres:
    image: postgres:18
    container_name: nexus-postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: nexus_user
      POSTGRES_PASSWORD: nexus_password
      POSTGRES_DB: nexus_db
    ports:
      - "5433:5432"
    volumes:
      - nexus-postgres-data:/var/lib/postgresql

  redis:
    image: redis:8
    container_name: nexus-redis
    restart: unless-stopped
    ports:
      - "6380:6379"
    volumes:
      - nexus-redis-data:/data

  # NOTE (local dev): the API service is commented out to avoid port 8000 conflicts
  # with the NestJS dev server run from the nexus-enterprise monorepo. We
  # generally don't need this container during development since we run the
  # API with `npm run dev:api` against the same Postgres/Redis.
  # api:
  #   build:
  #     context: ../..
  #     dockerfile: apps/api/Dockerfile
  #   image: ghcr.io/paulgagnon1969/ncc-api:chunk-v1
  #   container_name: nexus-api
  #   restart: unless-stopped
  #   env_file:
  #     - ../../apps/api/.env.docker
  #   ports:
  #     - "8000:8000"
  #   depends_on:
  #     - postgres
  #     - redis

volumes:
  nexus-postgres-data:
  nexus-redis-data:
